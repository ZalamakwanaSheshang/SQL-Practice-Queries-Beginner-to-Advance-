SELECT NAME FROM SYS.TABLES WHERE TYPE= 'U'

CREATE DATABASE RISE_TASKS_1
USE RISE_TASKS_1


-- 1. CREATING FOLLOWING TABLES
-- 1.1 STUDENTS
CREATE TABLE STUDENTS(
STD_ID INT PRIMARY KEY,
STD_NAME VARCHAR(255),
STD_AGE INT CHECK (STD_AGE > 18),
STD_GENDER VARCHAR(255)
)

-- 1.2 COURSES
CREATE TABLE COURSES (
COURSE_ID INT PRIMARY KEY,
COURSE_NAME VARCHAR(255),
CREDITS INT
)

-- 1.3 ENROLLMENTS
CREATE TABLE ENROLLMENTS(
ENROLLMENT_ID INT PRIMARY KEY,
STD_ID INT FOREIGN KEY REFERENCES STUDENTS(STD_ID)  ON UPDATE CASCADE ON DELETE CASCADE,
COURSE_IS INT FOREIGN KEY REFERENCES COURSES(COURSE_ID) ON UPDATE CASCADE ON DELETE CASCADE,
ENROLLMENT_DATE DATE DEFAULT GETDATE()
)

-- 1.4 GRADES
CREATE TABLE GRADES(
GRADE_ID INT PRIMARY KEY,
ENROLLMENT_ID INT FOREIGN KEY REFERENCES ENROLLMENTS(ENROLLMENT_ID) ON UPDATE CASCADE ON DELETE CASCADE,
GRADE VARCHAR(5)
)


-- 2. Insert sample data into all four tables (at least 5 students, 3 courses, and 10
-- enrollments).

-- STUDENTS TABLE
INSERT INTO STUDENTS VALUES
(101, 'SHESHANG ZALAMAKWANA',22,'MALE'),
(102,'DIGVIJAYSINH PARMAR',23,'MALE'),
(103,'VRAJ SAHA',21,'MALE'),
(104,'AYUSHI LOYA',22,'FEMALE'),
(105,'MONALI ZALA',23,'FEMALE')

INSERT INTO STUDENTS VALUES
(106, 'RUSABH KAUSALYA',20,'MALE')

-- COURSE TABLE
INSERT INTO COURSES VALUES
(11,'FULLSTACK',8),
(12,'DATA SCIENCE',9),
(13,'DATA ANALYSIS',7),
(14,'FS_PRACTICAL',10),
(15,'DS_PRACTICAL',10)

-- ENROLLMENT TABLE
INSERT INTO ENROLLMENTS VALUES
(1,101,11,'2025-07-01'),
(2,101,14,'2025-07-01'),
(3,102,12,'2025-07-04'),
(4,102,15,'2025-07-04'),
(5,103,13,'2025-07-05')

INSERT INTO ENROLLMENTS(ENROLLMENT_ID, STD_ID,COURSE_IS) VALUES
(6,104,13),
(7,105,11),
(8,105,14),
(9,105,12),
(10,105,15)

-- GRADES TABLE

INSERT INTO GRADES VALUES
(1001, 1, 'O+'),
(1002, 2, 'A'),
(1003, 3, 'C'),
(1004, 4, 'D'),
(1005, 5, 'B'),
(1006, 6, 'A+'),
(1007, 7, 'A'),
(1008, 8, 'B'),
(1009, 9, 'A'),
(1010, 10, 'O')


SELECT * FROM STUDENTS
SELECT * FROM COURSES
SELECT * FROM ENROLLMENTS
SELECT * FROM GRADES

-- 3. Write a query to list all students who are enrolled in any course.
SELECT * FROM STUDENTS
WHERE STD_ID IN 
(SELECT STD_ID FROM ENROLLMENTS)

-- 4. Write a query to find the names of students who are enrolled in the course
-- "FULL STACK".
SELECT * FROM STUDENTS S
INNER JOIN ENROLLMENTS E
ON S.STD_ID = E.STD_ID
WHERE COURSE_IS = 
(SELECT COURSE_ID FROM COURSES 
WHERE COURSE_NAME = 'FULLSTACK')

-- 5. Write a query to count how many students are enrolled in each course.
SELECT COURSE_IS, COUNT(STD_ID) FROM ENROLLMENTS
GROUP BY COURSE_IS

-- 6. Write a query to list students and their grades using JOIN across all relevant tables.
SELECT S.STD_NAME,E.ENROLLMENT_ID,G.GRADE 
FROM STUDENTS S
JOIN ENROLLMENTS E
ON S.STD_ID = E.STD_ID
JOIN GRADES G
ON G.ENROLLMENT_ID = E.ENROLLMENT_ID

-- 7. Write a query to find students who got grade 'A' in any course.
SELECT S.STD_ID, S.STD_NAME, C.COURSE_NAME, G.GRADE FROM STUDENTS S
JOIN ENROLLMENTS E
ON S.STD_ID = E.STD_ID
JOIN GRADES G
ON E.ENROLLMENT_ID = G.ENROLLMENT_ID
JOIN COURSES C
ON E.COURSE_IS = C.COURSE_ID
WHERE GRADE = 'A'

-- 8. Write a query to list courses that have more than 2 students enrolled.
SELECT C.COURSE_NAME,C.COURSE_ID FROM ENROLLMENTS E
JOIN COURSES C
ON E.COURSE_IS = C.COURSE_ID
GROUP BY C.COURSE_ID, C.COURSE_NAME
HAVING COUNT(E.STD_ID) >= 2

-- 9. Write a query to find the average age of students enrolled in each course.
SELECT C.COURSE_NAME, AVG(S.STD_AGE) AS AVG_AGE FROM STUDENTS S
JOIN ENROLLMENTS E
ON S.STD_ID = E.STD_ID
JOIN COURSES C
ON E.COURSE_IS = C.COURSE_ID
GROUP BY C.COURSE_NAME

-- 10. Write a query to list all students who are not enrolled in any course.
SELECT * FROM STUDENTS S
JOIN ENROLLMENTS E
ON S.STD_ID = E.STD_ID
WHERE E.ENROLLMENT_ID IS NULL

-- 11. Write a query to update the grade of a student in a specific enrollment.
UPDATE GRADES
SET GRADE = 'A'
WHERE ENROLLMENT_ID = 1

SELECT * FROM GRADES

-- 12. Write a query to delete a student and ensure all related enrollments and grades
-- are also deleted.
/*
ALTER TABLE ENROLLMENTS
ADD CONSTRAINT PRIMARY_KEY PRIMARY KEY (ENROLLMENT_ID)
*/
DELETE FROM STUDENTS
WHERE STD_ID = (SELECT STD_ID FROM STUDENTS 
				WHERE STD_NAME = 'VRAJ SAHA')

-- 13. Write a query to list students who enrolled after a specific date. (e.g., '2025-01-01').
SELECT S.STD_ID, S.STD_NAME, E.COURSE_IS, E.ENROLLMENT_DATE FROM STUDENTS S
JOIN ENROLLMENTS E
ON S.STD_ID = E.STD_ID
WHERE E.ENROLLMENT_DATE > '2025-07-10'

SELECT S.STD_ID, S.STD_NAME, E.ENROLLMENT_DATE FROM STUDENTS S
JOIN ENROLLMENTS E
ON S.STD_ID = E.STD_ID
WHERE E.ENROLLMENT_DATE > '2025-07-10'
GROUP BY S.STD_ID, S.STD_NAME, E.ENROLLMENT_DATE

-- 14. Write a query to find courses with less than 3 credits.
SELECT * FROM COURSES
WHERE CREDITS < 3

SELECT * FROM COURSES
WHERE CREDITS < 8

-- 15. Write a query to list students who are older than 20 and have received a grade of 'B'.
SELECT S.STD_ID, S.STD_NAME, S.STD_AGE, G.GRADE FROM STUDENTS S
JOIN ENROLLMENTS E
ON E.STD_ID = S.STD_ID
JOIN GRADES G
ON G.ENROLLMENT_ID = E.ENROLLMENT_ID
WHERE S.STD_AGE > 20 AND G.GRADE = 'B'

SELECT * FROM STUDENTS
SELECT * FROM ENROLLMENTS
SELECT * FROM GRADES
SELECT * FROM COURSES
